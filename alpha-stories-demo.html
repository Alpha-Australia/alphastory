<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alpha Stories Image Generator Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #8b5a3c 0%, #5c3d2e 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .content {
            padding: 30px;
        }

        .demo-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
        }

        .story-selector {
            margin-bottom: 20px;
        }

        .story-selector label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #5c3d2e;
        }

        .story-selector select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
            font-family: 'Georgia', serif;
        }

        .story-display {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #8b5a3c;
            margin-bottom: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .story-display h3 {
            color: #5c3d2e;
            margin-bottom: 10px;
        }

        .story-display p {
            line-height: 1.6;
            color: #333;
        }

        .api-key-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #fff9e6;
            border-radius: 8px;
            border: 1px solid #ffe066;
        }

        .api-key-section label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #5c3d2e;
        }

        .api-key-section input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 0.9em;
            font-family: monospace;
        }

        .art-style-section {
            margin-bottom: 20px;
        }

        .art-style-section label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #5c3d2e;
        }

        .art-style-section select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
            font-family: 'Georgia', serif;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            flex: 1;
            padding: 15px 30px;
            background: linear-gradient(135deg, #8b5a3c 0%, #5c3d2e 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .random-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .image-container {
            width: 100%;
            height: 400px;
            background: #f5f5f5;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .image-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .placeholder {
            text-align: center;
            color: #999;
            padding: 40px;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #8b5a3c;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #c62828;
        }

        .prompt-preview {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #4a90e2;
        }

        .prompt-preview h4 {
            color: #4a90e2;
            margin-bottom: 10px;
        }

        .prompt-preview p {
            font-family: monospace;
            font-size: 0.9em;
            line-height: 1.4;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® Alpha Stories Image Generator Demo</h1>
            <p>Transform real Alpha testimonies into beautiful Renaissance-style artwork</p>
        </div>

        <div class="content">
            <div class="demo-section">
                <h2>üìñ Select an Alpha Story</h2>
                
                <div class="story-selector">
                    <label for="storySelect">Choose a story to visualize:</label>
                    <select id="storySelect">
                        <option value="">Select a story...</option>
                    </select>
                </div>

                <div class="story-display" id="storyDisplay">
                    <h3>Story Preview</h3>
                    <p>Select a story from the dropdown above to see it here.</p>
                </div>

                <div class="button-group">
                    <button onclick="loadRandomStory()" class="random-btn">üé≤ Random Story</button>
                    <button onclick="loadStoryById(1)">üìñ Nick's Story</button>
                    <button onclick="loadStoryById(5)">üè• Dr. Tridiv's Story</button>
                    <button onclick="loadStoryById(9)">üìù Poem Story</button>
                </div>
            </div>

            <div class="demo-section">
                <h2>üé® Generate Image</h2>
                
                <div class="api-key-section">
                    <label for="apiKey">OpenAI API Key</label>
                    <input
                        type="password"
                        id="apiKey"
                        placeholder="sk-..."
                        autocomplete="off"
                    >
                    <small>Your API key is stored locally and never sent anywhere except OpenAI.</small>
                </div>

                <div class="art-style-section">
                    <label for="artStyle">Art Style</label>
                    <select id="artStyle">
                        <option value="renaissance">Renaissance</option>
                        <option value="minimalist">Minimalist / Line Drawing</option>
                        <option value="cartoon">Cartoon</option>
                    </select>
                </div>

                <div class="button-group">
                    <button onclick="generateImageFromStory()" id="generateBtn">üé® Generate Renaissance Image</button>
                    <button onclick="previewPrompt()" id="previewBtn">üëÅÔ∏è Preview Prompt</button>
                </div>

                <div class="image-container" id="imageContainer">
                    <div class="placeholder" id="placeholder">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        <p>Your Renaissance masterpiece will appear here</p>
                    </div>
                </div>

                <div id="error" style="display: none;" class="error"></div>
                <div id="promptPreview" style="display: none;" class="prompt-preview"></div>
            </div>
        </div>
    </div>

    <script src="csv-stories.js"></script>
    <script>
        let currentStory = null;
        let currentImageUrl = null;

        // Art style prompts (same as main app)
        const artStylePrompts = {
            'renaissance': 'Renaissance-style painting of {story}, featuring opulent details and rich colors, oil painting, sfumato technique, chiaroscuro dramatic lighting and shadows, classical composition with balanced symmetry, realistic human anatomy and proportions, elaborate period-appropriate costumes and drapery, intricate architectural details, atmospheric perspective, masterful brushwork in the manner of Leonardo da Vinci, Raphael, Titian, or Botticelli, 15th-16th century Italian Renaissance art style, highly detailed and realistic',

            'minimalist': 'Minimalist line drawing of {story}, simple clean black lines on white background, elegant minimal linework, continuous line art style, essential forms only with no shading, modern minimalist aesthetic, refined simplicity, uncluttered composition, single weight lines, artistic sketch quality, contemporary minimalist illustration, focus on essential shapes and contours, zen-like simplicity, sophisticated and refined',

            'cartoon': 'Cartoon illustration of {story}, vibrant bright colors, bold outlines and clean lines, expressive characters with exaggerated features, dynamic poses and emotions, playful friendly style, flat color fills with simple shading, fun and engaging composition, in the style of modern animation or comic books, cheerful and energetic, suitable for all ages, colorful and whimsical, professional cartoon art quality'
        };

        // Initialize the page
        window.addEventListener('DOMContentLoaded', () => {
            populateStoryDropdown();
            loadSavedApiKey();
        });

        function populateStoryDropdown() {
            const select = document.getElementById('storySelect');
            const stories = getAllStories();
            
            stories.forEach(story => {
                const option = document.createElement('option');
                option.value = story.id;
                option.textContent = `Story ${story.id}: ${story.story.substring(0, 60)}...`;
                select.appendChild(option);
            });

            // Add event listener for dropdown change
            select.addEventListener('change', (e) => {
                if (e.target.value) {
                    loadStoryById(parseInt(e.target.value));
                }
            });
        }

        function loadStoryById(id) {
            const story = getStoryById(id);
            if (story) {
                currentStory = story;
                displayStory(story);
                document.getElementById('storySelect').value = id;
            }
        }

        function loadRandomStory() {
            const story = getRandomStory();
            currentStory = story;
            displayStory(story);
            document.getElementById('storySelect').value = story.id;
        }

        function displayStory(story) {
            const storyDisplay = document.getElementById('storyDisplay');
            storyDisplay.innerHTML = `
                <h3>Story ${story.id}</h3>
                <p>${story.story}</p>
                ${story.source ? `<small><strong>Source:</strong> ${story.source}</small>` : ''}
            `;
        }

        function loadSavedApiKey() {
            const savedApiKey = localStorage.getItem('openai_api_key');
            if (savedApiKey) {
                document.getElementById('apiKey').value = savedApiKey;
            }
        }

        function saveApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (apiKey) {
                localStorage.setItem('openai_api_key', apiKey);
            }
        }

        function previewPrompt() {
            if (!currentStory) {
                showError('Please select a story first.');
                return;
            }

            const artStyle = document.getElementById('artStyle').value;
            const promptTemplate = artStylePrompts[artStyle];
            const fullPrompt = promptTemplate.replace('{story}', currentStory.story);

            const previewDiv = document.getElementById('promptPreview');
            previewDiv.innerHTML = `
                <h4>Generated Prompt Preview</h4>
                <p>${fullPrompt}</p>
            `;
            previewDiv.style.display = 'block';
        }

        async function generateImageFromStory() {
            if (!currentStory) {
                showError('Please select a story first.');
                return;
            }

            const apiKey = document.getElementById('apiKey').value.trim();
            const artStyle = document.getElementById('artStyle').value;
            const errorDiv = document.getElementById('error');
            const generateBtn = document.getElementById('generateBtn');
            const placeholder = document.getElementById('placeholder');

            // Reset error
            errorDiv.style.display = 'none';
            errorDiv.textContent = '';

            // Validation
            if (!apiKey) {
                showError('Please enter your OpenAI API key.');
                return;
            }

            // Save API key
            saveApiKey();

            // Show loading
            generateBtn.disabled = true;
            generateBtn.textContent = 'Generating...';

            placeholder.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Creating your Renaissance masterpiece...</p>
                </div>
            `;

            try {
                // Get the art style prompt template and insert the story
                const promptTemplate = artStylePrompts[artStyle];
                const fullPrompt = promptTemplate.replace('{story}', currentStory.story);

                console.log('Generated Prompt:', fullPrompt);

                const response = await fetch('https://api.openai.com/v1/images/generations', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'dall-e-3',
                        prompt: fullPrompt,
                        n: 1,
                        size: '1024x1024',
                        quality: 'standard'
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error?.message || 'Failed to generate image');
                }

                // Display image
                currentImageUrl = data.data[0].url;
                placeholder.innerHTML = `<img src="${currentImageUrl}" alt="Generated Renaissance Image">`;

                console.log('Image generated successfully:', currentImageUrl);

            } catch (error) {
                showError(`Error: ${error.message}`);
                placeholder.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <p>Your Renaissance masterpiece will appear here</p>
                `;
            } finally {
                generateBtn.disabled = false;
                generateBtn.textContent = 'üé® Generate Renaissance Image';
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        // Save API key when changed
        document.getElementById('apiKey').addEventListener('change', saveApiKey);
    </script>
</body>
</html>
